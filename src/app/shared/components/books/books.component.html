<div class="container my-5">
  <app-book-filter-bar
    [(selectedGenres)]="selectedGenres"
    [(selectedLocation)]="queryParams.location"
    [(availableSelected)]="queryParams.showAvailable"
    (filterChange)="onFilterChange($event)"
    (viewMode)="onViewModeChange($event)"
  >
  </app-book-filter-bar>
  <ng-template [ngIf]="books?.length==0" [ngIfElse]="booksExist">
    <div class="d-flex justify-content-center border border-light p-5">
      <img src="https://cdn.dribbble.com/users/1512427/screenshots/6201637/02.png">
    </div>
  </ng-template>

  <ng-template #booksExist>
    <ng-template [ngIf]="isBlockView" [ngIfElse]="tableView">
      <div class="animated fadeInRight">
        <div class="container my-3">
          <section>
            <div class="row">
              <div class="col-xl-6 mb-4" *ngFor="let book of books; let key = index">
                <div class="card card-ecommerce card-height">
                  <div class="view overlay">
                    <div class="container">
                      <div class="row">
                        <div class="col-lg-6 photo-padding">
                          <div *ngIf="book?.imagePath; then thenBlock else elseBlock"></div>
                          <ng-template #thenBlock>
                              <img src="{{apiUrl}}/{{book.imagePath}}" class="img-fluid img-height" height="500px" width="500px">
                          </ng-template>
                          <ng-template #elseBlock>
                              <img
                                src="https://images.squarespace-cdn.com/content/582caad246c3c4568a7e562e/1519054615446-T9CP1E3U87P6M709L6E3/booktitle.jpg?content-type=image%2Fjpeg"
                                class="img-fluid img-height" height="500px" width="500px">
                          </ng-template>
                        </div>
                        <div class="col-lg-6 photo-padding">
                          <div class="card-body">
                            <a [routerLink]="['/book/', book.id]"><h5 class="card-title"><strong>{{book.name}}</strong>
                            </h5></a>
                            <ng-template [ngIf]="book.authors.length==1" [ngIfElse]="manyAuthors">
                              Author :
                            </ng-template>

                            <ng-template #manyAuthors>Authors:</ng-template>
                            <ng-template [ngIf]="book.authors.length<=3" [ngIfElse]="manyAuthorsEllipsis">
                              <strong *ngFor="let author of book.authors; let i = index">
                                <ng-template [ngIf]="i!=0">, </ng-template>
                                {{author.firstName}} {{author.lastName}}
                              </strong>
                            </ng-template>
                            <ng-template #manyAuthorsEllipsis>
                              <strong *ngFor="let author of book.authors | slice:0:3; let i = index">
                                <ng-template [ngIf]="i!=0">, </ng-template>
                                {{author.firstName}} {{author.lastName}}
                              </strong>
                              <strong>
                                <span matTooltipHideDelay="1000" [matTooltip]="book.authors | Ellipsis:'authors':3" matTooltipClass="list-tooltip"
                                      class="text-primary">(...)</span>
                              </strong>
                            </ng-template>

                            <br>
                            <ng-template [ngIf]="book.genres.length==1" [ngIfElse]="manyGenres">Category:</ng-template>
                            <ng-template #manyGenres>Categories:</ng-template>

                            <ng-template [ngIf]="book.genres.length<=3" [ngIfElse]="manyGenresEllipsis">
                              <strong *ngFor="let genre of book.genres;let i = index">
                                <ng-template [ngIf]="i!=0">, </ng-template>
                                {{genre.name}}
                              </strong>
                            </ng-template>
                            <ng-template #manyGenresEllipsis>
                              <strong *ngFor="let genre of book.genres | slice:0:3;let i = index">
                                <ng-template [ngIf]="i!=0">, </ng-template>
                                {{genre.name}}
                              </strong>
                              <strong>
                                <span matTooltipHideDelay="1000" [matTooltip]="book.genres | Ellipsis:'genres':3" matTooltipClass="list-tooltip"
                                      class="text-primary">(...)</span>
                              </strong>
                            </ng-template>
                            <br>
                            <span>
                              Location: {{ book?.locations[0]?.location?.city + " " + book?.locations[0]?.location?.officeName }}
                            </span>
                            <br>
                            <span>
                              Status:
                            </span>
                            <span [ngSwitch]="bookStatus[key]">
              <ng-template ngSwitchCase="1"><span class="badge badge-success product">Available</span>
                <br>
                <a role="button" class="btn btn-primary ml-0" [hidden]="!isAuthenticated()" (click)="requestBook(book.id)">Request</a>
              </ng-template>
              <ng-template ngSwitchCase="2"><span class="badge badge-info product">Requested</span>
              <br>
              <a *ngIf="isRequester" role="button" class="btn btn-primary ml-0" (click)="cancelRequest(book.id)">Cancel request</a>
              </ng-template>
              <ng-template ngSwitchCase="3"><span class="badge badge-info product">Reading</span></ng-template>
            </span>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </ng-template>
    <ng-template #tableView>
      <div class="card m-3 animated fadeInRight" *ngFor="let book of books; let key = index">
        <div class="row no-gutters">
          <div class="col-auto">
            <div *ngIf="book?.imagePath; then thenBlock else elseBlock"></div>
            <ng-template #thenBlock>
              <img src="{{apiUrl}}/{{book.imagePath}}" class="rounded float-left" height="200" width="200" alt="rf">
            </ng-template>
            <ng-template #elseBlock>
              <img
                src="https://images.squarespace-cdn.com/content/582caad246c3c4568a7e562e/1519054615446-T9CP1E3U87P6M709L6E3/booktitle.jpg?content-type=image%2Fjpeg"
                class="rounded float-left" height="200" width="200" alt="rf">
            </ng-template>
          </div>
          <div class="col m-2">
            <div class="card-block px-2">
              <a [routerLink]="['/book/', book.id]"><h4 class="card-title"><strong>{{book.name}}</strong></h4></a>

              <p class="card-text">
                <ng-template [ngIf]="book.authors.length==1" [ngIfElse]="manyAuthors">
                  Author:
                </ng-template>

                <ng-template #manyAuthors>Authors:</ng-template>
                <ng-template [ngIf]="book.authors.length<=5" [ngIfElse]="manyAuthorsEllipsis">
                  <strong *ngFor="let author of book.authors; let i = index">
                    <ng-template [ngIf]="i!=0">, </ng-template>
                    {{author.firstName}} {{author.lastName}}
                  </strong>
                </ng-template>
                <ng-template #manyAuthorsEllipsis>
                  <strong *ngFor="let author of book.authors | slice:0:5; let i = index">
                    <ng-template [ngIf]="i!=0">, </ng-template>
                    {{author.firstName}} {{author.lastName}}
                  </strong>
                  <strong>
                    <span matTooltipHideDelay="1000" [matTooltip]="book.authors | Ellipsis:'authors':5" matTooltipClass="list-tooltip"
                          class="text-primary">(...)</span>
                  </strong>
                </ng-template>
                <br>
                <ng-template [ngIf]="book.genres.length==1" [ngIfElse]="manyGenres">Category:</ng-template>
                <ng-template #manyGenres>Categories:</ng-template>

                <ng-template [ngIf]="book.genres.length<=7" [ngIfElse]="manyGenresEllipsis">
                  <strong *ngFor="let genre of book.genres;let i = index">
                    <ng-template [ngIf]="i!=0">, </ng-template>
                    {{genre.name}}
                  </strong>
                </ng-template>
                <ng-template #manyGenresEllipsis>
                  <strong *ngFor="let genre of book.genres | slice:0:7;let i = index">
                    <ng-template [ngIf]="i!=0">, </ng-template>
                    {{genre.name}}
                  </strong>
                  <strong>
                    <span matTooltipHideDelay="1000" [matTooltip]="book.genres | Ellipsis:'genres':7" matTooltipClass="list-tooltip"
                          class="text-primary">(...)</span>
                  </strong>
                </ng-template>
                <br>
                <span>
                  Location: {{ book?.locations[0]?.location?.city + " " + book?.locations[0]?.location?.officeName }}
                </span>
                <br>
                <span>Status: </span>
                <span [ngSwitch]="bookStatus[key]">
              <ng-template ngSwitchCase="1"><span class="badge badge-success product">Available</span>
                <br>
                <a role="button" class="btn btn-primary ml-0" [hidden]="!isAuthenticated()" (click)="requestBook(book.id)">Request</a>
              </ng-template>
              <ng-template ngSwitchCase="2"><span class="badge badge-info product">Requested</span>
              <br>
              <a *ngIf="isRequester" role="button" class="btn btn-primary ml-0" (click)="cancelRequest(book.id)">Cancel request</a>
              </ng-template>
              <ng-template ngSwitchCase="3"><span class="badge badge-info product">Reading</span></ng-template>
            </span>

              </p>

            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </ng-template>

  <app-pagination *ngIf="books && books.length > 0" [arraySize]="totalSize" [pageSize]="queryParams.pageSize"
                  [selectedPage]="queryParams.page" (onPageChange)="pageChanged($event)">
  </app-pagination>
</div>
